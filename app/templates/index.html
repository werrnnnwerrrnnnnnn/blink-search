<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<form method="POST">
    <input type="text" name="query" placeholder="Enter keyword" required>

    <label for="limit">Reviews to load:</label>
    <select name="limit" id="limit">
        <option value="100">100</option>
        <option value="500" selected>500</option>
        <option value="1000">1000</option>
        <option value="2000">2000</option>
        <option value="5000">5000</option>
    </select>

    <button type="submit">Search</button>
</form>

{% if result %}
    <div class="search-section">
        {% for algo in ['linear', 'inverted', 'trie', 'btree'] %}
            <h3>{{ algo|capitalize }} Search</h3>
            <p>
                <strong>Reviews searched:</strong> {{ limit }} |
                <strong>Matches found:</strong> {{ result[algo].matches | length }}
            </p>
            <p>
                <em>Time:</em> {{ result[algo].time }} ms ({{ result[algo].time_sec }} s) |
                <em>Memory:</em> {{ result[algo].memory }} KB
            </p>
            <a href="{{ url_for('results', query=query, limit=limit, algorithm=algo) }}">View all results â†’</a>
            <hr>
        {% endfor %}
    </div>

    <h3>ðŸ“Š Performance Charts</h3>

    <!-- Chart 1: Query Time -->
    <h3>Chart 1: Query Time</h3>
    <canvas id="timeChart" width="600" height="100"></canvas>

    <!-- Chart 2: Memory Usage -->
    <h3>Chart 2: Memory Usage</h3>
    <canvas id="memoryChart" width="600" height="100"></canvas>

    <!-- Chart 3: Speedup -->
    <h3>Chart 3: Speedup</h3>
    <canvas id="speedupChart" width="600" height="100"></canvas>

    <script>
        const labels = ['Linear', 'Inverted', 'Trie', 'BTree'];

        const times = [
            {{ result.linear.time }},
            {{ result.inverted.time }},
            {{ result.trie.time }},
            {{ result.btree.time }}
        ];

        const memory = [
            {{ result.linear.memory }},
            {{ result.inverted.memory }},
            {{ result.trie.memory }},
            {{ result.btree.memory }}
        ];

        const speedup = [
            1,
            {{ "%.2f" % (result.linear.time / result.inverted.time) }},
            {{ "%.2f" % (result.linear.time / result.trie.time) }},
            {{ "%.2f" % (result.linear.time / result.btree.time) }}
        ];

        new Chart(document.getElementById('timeChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Query Time (ms)',
                    data: times,
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e']
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });

        new Chart(document.getElementById('memoryChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Memory Usage (KB)',
                    data: memory,
                    backgroundColor: ['#ff6b6b', '#6bcff6', '#6bf68e', '#f6f16b']
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });

        new Chart(document.getElementById('speedupChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Speedup (vs Linear)',
                    data: speedup,
                    backgroundColor: ['#888', '#1cc88a', '#36b9cc', '#f6c23e']
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });
    </script>
{% endif %}